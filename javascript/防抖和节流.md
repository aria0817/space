## 防抖和节流 debounce(防抖)和 throttle（节流）
本质上是优化高频率执行代码的一种手段,比如浏览器scroll、keypress、mousemove等事件在触发时，会不断地调用绑定在事件上的回调函数，极大地浪费资源，降低前端性能。

### 1.定义

防抖: n 秒后在执行该事件，若在 n 秒内被重复触发，则重新计时(比如用户搜索)
节流: n 秒内只运行一次，若在 n 秒内重复触发，只有一次生效（比如用户频繁触发某个事件）

### 2. 节流实现
```
function throttled(fn,delay=500){
    let timer = null;
    return function(...args){
        if (!timer) {
            timer = setTimeout(() => {
                fn.apply(this,args);
                timer = null;
            },delay)
        }
    }
}
function throttled(fn, delay) {
    let timer = null
    let starttime = Date.now()
    return function () {
        let curTime = Date.now() // 当前时间
        let remaining = delay - (curTime - starttime)  // 从上一次到现在，还剩下多少多余时间
        let context = this
        let args = arguments
        clearTimeout(timer)
        if (remaining <= 0) {
            fn.apply(context, args)
            starttime = Date.now()
        } else {
            timer = setTimeout(fn, remaining);
        }
    }
}

```
### 3. 防抖实现 多次触发 重新计时在触发

```
function debounce (fn,wait){
    let timer = null
    return function(...args){
        let context = this; // 保存this指向
        clearTimeout(timer)
        timer = setTimeout(() => {
            fn.apply(context,args)
        }, wait);
    }
}

// 防抖如果需要立即执行 // need to do
function debounce(fn, wait, immediate) {
    let timer = null
    return function (...args) {
        let context = this; // 保存this指向
        if (timer) clearTimeout(timer)

        if (immediate) {
            let callNow = !timer; // 第一次会立即执行，以后只有事件执行后才会再次触发
            timeout = setTimeout(function () {
                timeout = null;
            }, wait)
            if (callNow) {
                fn.apply(context, args)
            }

        } else {
            timer = setTimeout(() => {
                fn.apply(context, args)
            }, wait);
        }

    }
}


```

### 3.应用场景
防抖在连续的事件，只需触发一次回调的场景有：
* 搜索框搜索输入。只需用户最后一次输入完，再发送请求
* 手机号、邮箱验证输入检测
* 窗口大小resize。只需窗口调整完成后，计算窗口大小。防止重复渲染。
<br>

节流在间隔一段时间执行一次回调的场景有：
* 滚动加载，加载更多或滚到底部监听
* 搜索框，搜索联想功能
